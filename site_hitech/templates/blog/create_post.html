{% extends 'base.html' %}
{% load static %}

{% block title %}Tạo bài viết mới - Hitech NDT{% endblock %}

{% block extra_css %}
{{ form.media.css }}
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
.create-post-container {
    max-width: 900px;
    margin: 30px auto;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.08);
    padding: 32px 24px;
}
.section-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #2c5364;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}
.form-group {
    margin-bottom: 20px;
}
.form-label {
    font-weight: 600;
    color: #495057;
    margin-bottom: 8px;
    display: block;
}
.form-control, .form-select {
    border: 2px solid #e9ecef;
    border-radius: 8px;
    padding: 12px 15px;
    font-size: 1rem;
    width: 100%;
    transition: all 0.3s ease;
}
.form-control:focus, .form-select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.15);
}
.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    color: #fff;
    font-weight: 600;
    padding: 12px 32px;
    border-radius: 8px;
    transition: background 0.3s;
}
.btn-primary:hover {
    background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
}
.seo-box {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 24px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
}
.seo-score-circle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 10px;
    font-size: 1.2rem;
    font-weight: bold;
    color: white;
    background: linear-gradient(135deg, #28a745, #20c997);
}
</style>
{% endblock %}

{% block content %}
<div class="create-post-container">
    <h1 class="section-title"><i class="fas fa-plus-circle"></i> Tạo bài viết mới</h1>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-group">
            <label for="{{ form.title.id_for_label }}" class="form-label">Tiêu đề *</label>
            {{ form.title }}
        </div>
        <div class="form-group">
            <label for="{{ form.summary.id_for_label }}" class="form-label">Tóm tắt</label>
            {{ form.summary }}
        </div>
        <div class="form-group">
            <label for="{{ form.category.id_for_label }}" class="form-label">Chuyên mục</label>
            {{ form.category }}
        </div>
        <div class="form-group">
            <label for="{{ form.tags.id_for_label }}" class="form-label">Tags</label>
            {{ form.tags }}
        </div>
        <div class="form-group">
            <label for="{{ form.featured_image.id_for_label }}" class="form-label">Ảnh đại diện</label>
            {{ form.featured_image }}
        </div>
        <div class="form-group">
            <label for="{{ form.meta_title.id_for_label }}" class="form-label">Meta Title</label>
            {{ form.meta_title }}
        </div>
        <div class="form-group">
            <label for="{{ form.meta_description.id_for_label }}" class="form-label">Meta Description</label>
            {{ form.meta_description }}
        </div>
        <div class="form-group">
            <label for="{{ form.keywords.id_for_label }}" class="form-label">Từ khóa</label>
            {{ form.keywords }}
        </div>
        <div class="form-group">
            <label for="{{ form.content.id_for_label }}" class="form-label">Nội dung *</label>
            {{ form.content }}
        </div>
        <div class="form-group">
            <label class="form-label">Xuất bản</label>
            {{ form.published }}
        </div>
        <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane me-2"></i> Đăng bài viết</button>
    </form>
    <div class="seo-box mt-4">
        <h3 class="section-title"><i class="fas fa-search"></i> Phân tích SEO</h3>
        <div class="seo-score-circle" id="seo-score-circle">
            <span id="seo-score-number">--</span>
        </div>
        <div id="seo-score-text">Chưa có dữ liệu</div>
        <div id="seo-details" style="margin-top: 16px;"></div>
        <button type="button" class="btn btn-primary mt-2" onclick="analyzeSEO()">Tính điểm</button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ form.media.js }}
<script>
// Character counter & SEO analysis (giữ lại logic cũ)
document.addEventListener('DOMContentLoaded', function() {
    const metaTitle = document.getElementById('id_meta_title');
    const metaDesc = document.getElementById('id_meta_description');
    const titleCount = document.getElementById('meta-title-count');
    const descCount = document.getElementById('meta-desc-count');
    if (metaTitle && titleCount) {
        metaTitle.addEventListener('input', function() {
            const length = this.value.length;
            titleCount.textContent = length + '/60';
            titleCount.className = 'char-count' + (length > 60 ? ' danger' : length > 50 ? ' warning' : '');
        });
    }
    if (metaDesc && descCount) {
        metaDesc.addEventListener('input', function() {
            const length = this.value.length;
            descCount.textContent = length + '/160';
            descCount.className = 'char-count' + (length > 160 ? ' danger' : length > 140 ? ' warning' : '');
        });
    }
});
function analyzeSEO() {
    const title = document.getElementById('id_title')?.value || '';
    const content = document.getElementById('id_content')?.value || '';
    const metaTitle = document.getElementById('id_meta_title')?.value || '';
    const metaDesc = document.getElementById('id_meta_description')?.value || '';
    const keywords = document.getElementById('id_keywords')?.value || '';
    let totalScore = 0;
    let maxScore = 100;
    let details = {};
    // Title
    const titleScore = Math.min(20, title.length * 0.5);
    totalScore += titleScore;
    details.title = { score: Math.round(titleScore), max_score: 20, strengths: title.length > 10 ? ['Tiêu đề có độ dài phù hợp'] : [], issues: title.length < 10 ? ['Tiêu đề quá ngắn'] : [] };
    // Content
    const contentScore = Math.min(30, content.length * 0.1);
    totalScore += contentScore;
    details.content = { score: Math.round(contentScore), max_score: 30, strengths: content.length > 100 ? ['Nội dung đủ dài'] : [], issues: content.length < 100 ? ['Nội dung quá ngắn'] : [] };
    // Meta title
    const metaTitleScore = Math.min(15, metaTitle.length * 0.3);
    totalScore += metaTitleScore;
    details.meta_title = { score: Math.round(metaTitleScore), max_score: 15, strengths: metaTitle.length > 30 ? ['Meta title đủ dài'] : [], issues: metaTitle.length < 30 ? ['Meta title quá ngắn'] : [] };
    // Meta desc
    const metaDescScore = Math.min(15, metaDesc.length * 0.2);
    totalScore += metaDescScore;
    details.meta_description = { score: Math.round(metaDescScore), max_score: 15, strengths: metaDesc.length > 50 ? ['Meta description đủ dài'] : [], issues: metaDesc.length < 50 ? ['Meta description quá ngắn'] : [] };
    // Keywords
    const keywordsScore = keywords ? 10 : 0;
    totalScore += keywordsScore;
    details.keywords = { score: keywordsScore, max_score: 10, strengths: keywords ? ['Có từ khóa'] : [], issues: !keywords ? ['Chưa có từ khóa'] : [] };
    // Update UI
    const finalScore = Math.round(totalScore);
    document.getElementById('seo-score-number').textContent = finalScore;
    document.getElementById('seo-score-text').textContent = `Điểm SEO: ${finalScore}/100`;
    // Update details
    let detailsHTML = '';
    for (const [section, detail] of Object.entries(details)) {
        detailsHTML += `<div><b>${section}</b>: ${detail.score}/${detail.max_score}`;
        if (detail.strengths.length) detailsHTML += `<br><span style='color:green'>${detail.strengths.join(', ')}</span>`;
        if (detail.issues.length) detailsHTML += `<br><span style='color:red'>${detail.issues.join(', ')}</span>`;
        detailsHTML += '</div>';
    }
    document.getElementById('seo-details').innerHTML = detailsHTML;
}
</script>
{% endblock %} 