{% extends "admin/base_site.html" %}

{% block content %}
<div class="chat-container">
    <div class="chat-messages" id="chat-messages">
        <!-- Tin nhắn sẽ được hiển thị ở đây -->
    </div>
    <div class="chat-input">
        <input type="text" id="chat-message-input" placeholder="Nhập tin nhắn...">
        <button id="chat-message-submit">Gửi</button>
    </div>
</div>

<style>
.chat-container {
    max-width: 800px;
    margin: 20px auto;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.chat-messages {
    height: 400px;
    overflow-y: auto;
    padding: 20px;
    background: #f9f9f9;
}

.chat-input {
    display: flex;
    padding: 10px;
    background: #fff;
    border-top: 1px solid #ddd;
}

#chat-message-input {
    flex: 1;
    padding: 8px;
    margin-right: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

#chat-message-submit {
    padding: 8px 16px;
    background: #79aec8;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

#chat-message-submit:hover {
    background: #417690;
}

.message {
    margin: 10px 0;
    padding: 10px;
    border-radius: 4px;
}

.message.admin {
    background: #e3f2fd;
    margin-left: 20%;
}

.message.user {
    background: #f5f5f5;
    margin-right: 20%;
}
</style>

<script>
    const chatSocket = new WebSocket(
        'ws://' + window.location.host + '/ws/chat/admin/'
    );

    const messagesDiv = document.getElementById('chat-messages');
    const messageInputDom = document.getElementById('chat-message-input');
    const submitButton = document.getElementById('chat-message-submit');

    chatSocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        const messageElement = document.createElement('div');
        messageElement.classList.add('message');
        messageElement.classList.add(data.type.toLowerCase());
        messageElement.textContent = data.message;
        messagesDiv.appendChild(messageElement);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    };

    submitButton.onclick = function(e) {
        const message = messageInputDom.value;
        chatSocket.send(JSON.stringify({
            'message': message,
            'type': 'ADMIN'
        }));
        messageInputDom.value = '';
    };

    messageInputDom.onkeyup = function(e) {
        if (e.keyCode === 13) {
            submitButton.click();
        }
    };
</script>
{% endblock %}